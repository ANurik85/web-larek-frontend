# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ — папка с общий кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типи данных

Карточка товара

```
interface ICard {
  id: string;
  description: string;
  title: string;
  category: string;
  price: number;
  image: string;
}
```

Данные для формы

```
Interface IForm {
  address: string;
  phone: string;
  email: string;
  total: number;
  payment: string;
  valid: boolean;
  errors: string[];
}
```

Интерфейс описывает структуру данных карточек и методы для работы с ними.

Interface ICardData:

- `basket: string[]` - Массив строк, представляющий корзину.
- `preview: string | null` - Строка или null, представляющая предварительный просмотр.
- `order: IOrder | null` - Объект типа IOrder или null, представляющий заказ.
- `cards: ICard[]` - Массив объектов карточек.
- `preview: string | null` - Для предварительного просмотра товара
- `getCard(cardId: string): ICard` - Метод для получения карточки по её идентификатору.
- `addBasketCard(BasketCard: TBasketCard): void` - Метод для добавления карточки в корзину.
- `getBasketCard(): TBasketCard[]` - Метод для получения всех карточек в корзине.
- `deleteBasketCard(cardId: string): void` - Метод для удаления карточки из корзины по её идентификатору.
- `checkFormValidation(data: Record<keyof TValidationInfo, string>): boolean` - Метод для проверки валидности данных формы.
- `reserFormInput(data: Record<keyof TValidationInfo, string>): void` - Метод для сброса данных формы.
- `placeholderFormInput(data: Record<keyof TValidationInfo, string>): void` - Метод для установки плейсхолдеров в данные формы.
- `checkAddress(value: string): boolea` - Метод для проверки валидности адреса.
- `checkPhone(value: string) : boolean` - Метод для проверки валидности номера телефона.
- `checkEmail(value: string): boolean` - Метод для проверки валидности eemail.

Интерфейс расширяет TValidationInfo и включает массив строк, представляющий элементы заказа.

```
interface IOrder extends TValidationInfo {
  items: string[]
}
```

- Интерфейс для выбора сопособ оплаты и добавление адреса

```
interface TAddressForm {
  address: string;
  paymentMethod: 'card' | 'cash';
}
```

Интерфейс определяет структуру результата заказа

```
interface IOrderResult {
  id: string;
}
```

Данные для выбраное карточка товара

```
export type TCardfull = Pick<ICard, 'title' | 'description' | 'category' | 'price'>;
```

Данные для корзина с товарами

```
export type TBasketForm = Pick<IForm, 'total'> & Pick<ICard, 'title' | 'price'>;
```

Данные форма для заполнение полей e-email и телефон

```
export type TСontactsForm = Pick<IForm, 'email' | 'phone'>;
```

Данные для отображение успешной покупки и обшая сумма заказа

```
export type TOrderSuccess = Pick<IForm, 'total'>;
```

Данные для отображение карточки товара в корзину

```
export type TBasketCard = Pick<ICard, 'title' | 'price'>;
```

Данные для проверки валидности поля формы

```
export type TValidationInfo = Pick<IForm, 'email' | 'phone' | 'address'>;
```

Данные для отображение текст ошибки валидности поля формы

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Данные для карточки товара и общая сумма в корзину

```
export type TBasketForm = Pick<IForm, 'total'> & Pick<ICard, 'title' | 'price'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- **слой данных, отвечает за хранение и изменение данных,**
- **слой представления, отвечает за отображение данных на странице,**
- **презентер, отвечает за связь представления и данных.**

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Model

Абстрактный класс Model, Это базовый класс, который нельзя инстанцировать напрямую. Он предназначен для наследования другими классами.

- Конструктор: Принимает частичные данные типа T и объект events, который реализует интерфейс `IEvents`.
- Данные присваиваются экземпляру класса с помощью `Object.assign`.
- Метод `emitChanges`: Этот метод уведомляет всех подписчиков о том, что модель изменилась, вызывая метод emit у объекта events.

_Функция isModel: Это TypeScript гарда (type guard), которая проверяет, является ли объект экземпляром класса Model._

### Слой данных

#### Класс CardsData

Класс CardsData наследуется от `Model` и управляет данными карточек, корзиной и заказами.

- `_cards: ICard[]` - массив объектов товара
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `basket: string[]` - Корзина.
- `catalog: ICard[]` - Каталог карточек.
- `loading: boolean` - Флаг загрузки.
- `order: IOrder` - Объект заказа.
- `formErrors: FormErrors` - Ошибки формы.
- `id: string` - уникальный идентификатор
- `description: string` - описание товара
- `title: string` - зоголовок товара
- `category: string` - категория товара
- `price: number` - цена товара

Конструктор инициализирует объект `CardsData` с начальными значениями и событиями.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- `getCard()` - получаем список товаров
- `addBasketCard()` - добавляет товар в корзину
- `toggleOrderedLot()` - Добавляет или удаляет карточку из заказа.
- `clearBasket()` - Очищает корзину.
- `getTotal()` - Возвращает общую стоимость заказа.
- `setCatalog(items: ILot[])` - Устанавливает каталог карточек.
- `setPreview(item: ICard)` - Устанавливает превью карточки.
- `setOrderField()` - Устанавливает значение поля заказа.
- `validateOrder()` - Валидирует заказ и возвращает true, если ошибок нет.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Form

Класс `Form` представляет собой компонент формы, который управляет элементами формы и обрабатывает события ввода и отправки.
Конструктор класса принимает инстант брокера событий\

В полях класса хранятся следующие данные:

- `protected _submit: HTMLButtonElement` - Элемент кнопки отправки.
- `protected _errors: HTMLElement` - Элемент для отображения ошибок формы.

Методы:

- `onInputChange` Обрабатывает изменения ввода и генерирует событие.
- `set valid` Включает или отключает кнопку отправки в зависимости от валидности формы.
- `set errors` Устанавливает сообщения об ошибках в форме.
- `render` Отображает форму с заданным состоянием.

#### Класс Modal

Класс наследует Component и реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- Конструктор принимает контейнер и объект событий. Инициализирует кнопки закрытия и контент модального окна.
- События добавляет обработчики событий для закрытия модального окна.

Поля класса:

- `_closeButton: HTMLButtonElement` - Кнопка закрытие и подтверждения
- `_content: HTMLElement` Для отображение контента

Методы:

- Сеттер `content` Обновляет содержимое модального окна.
- `open` Открывает модальное окно и вызывает событие modal:open.
- `close` Закрывает модальное окно, очищает содержимое и вызывает событие modal:close.
- `render` Обновляет данные компонента и открывает модальное окно.

#### Класс Card

Отвечает за отображение карточки, класс `Card` представляет собой компонент, который используется для отображения карточки с информацией. Он включает в себя элементы заголовка, категории, цены, изображения и описания. Класс используется для отображения карточrb товара на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\

Поля класса содержат элементы разметки элементов карточки:

- `protected _title: HTMLElement` - элемент заголовка карточки.
- `protected _category: HTMLElement` - элемент категории карточки.
- `protected _price: HTMLElement` - элемент цены карточки.
- `protected _image?: HTMLImageElement` - элемент изображения карточки (опционально).
- `protected _description?: HTMLElement` - элемент описания карточки (опционально).

Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Методы:

- `set id(value: string)` - Устанавливает идентификатор карточки.
- `get id(): string` - Возвращает идентификатор карточки.
- `set title(value: string)` - Устанавливает заголовок карточки.
- `get title(): string` - Возвращает заголовок карточки.
- `set image(value: string)` - Устанавливает изображение карточки.
- `set description(value: string | string[])` - Устанавливает описание карточки. Может принимать строку или массив строк.
- `render(data: Partial<ICard>): HTMLElement` - Отображает карточку с заданными данными.

#### Класс ModalBasket

Расширяет класс Component. Предназначен для реализации модального окна корзину. При открытии модального окна отображается в корзину название товара, цена товара, общая сумма товара.

Поля класса:

- `_list`: элемент HTML, представляющий список товаров в корзине.
- `_total`: элемент HTML, отображающий общую стоимость товаров.
- `_button`: элемент HTML, представляющий кнопку для оформления заказа.
- `_deleted`: элемент HTML, представляющий кнопку для удаления товара.

Конструктор принимает два параметра: container: контейнер, в котором находятся элементы корзины.
events: объект событий. В конструкторе происходит следующее:

- Вызов конструктора родительского класса `super(container)`.
- Инициализация полей `_list`, `_total`, `_button` и `_deleted` с помощью функции ensureElement.
- Добавление обработчика событий для кнопки `_button`, который вызывает событие order:open.
- Добавление обработчика событий для элемента `_deleted`, который вызывает событие `basket:delete` с идентификатором товара.
  Методы:
- Сеттер `set deleted` удаляет товары из корзины по их идентификаторам:
- Сеттер `set total` обновляет общую стоимость товаров в корзине:
- Метод приватный `removeItem` удаляет товар из списка по его идентификатору:

#### Класс OrderAddress

Класс расширяет компонент Component и предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данные в поле ввода инициирует событие изменения данных.

Поля класса:

- `_close` элемент HTML, представляющий кнопку закрытия.
- `_paymentButtons` список кнопок для выбора метода оплаты.
- `_address` элемент ввода для адреса.

Методы:

- Метод `set address` устанавливает значение поля ввода адреса.
- `selectPaymentMethod` - Определяет кнопку, вызвавшую событие. Удаляет класс selected у всех кнопок. Добавляет класс selected к выбранной кнопке. Устанавливает значение поля ввода paymentMethod в соответствии с именем выбранной кнопки.

#### Класс OrderContacts

Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в поля ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\

- Поля: `_phone`, `_email` и `_close` используются для хранения ссылок на соответствующие элементы формы.

- Cеттеры:`set phone`, `set email` устанавливают значения полей phone и email в форме, используя метод namedItem для поиска элементов по имени.

#### Класс Page

Класс `Page` наследуется от `Component<IPage>` и используется для управления элементами страницы, такими как каталог и корзина.

Свойства:

- `_catalog: HTMLElement;` - элемент каталога. Хранит ссылку на HTML-элемент, представляющий содержимое каталога.
- `_basket: HTMLElement;` - элемент корзины. Хранит ссылку на HTML-элемент, представляющий корзину.

Конструктор

- `constructor(container: HTMLElement, protected events: IEvents)` - Конструктор принимает контейнер и события в качестве параметров. Он инициализирует элементы каталога и корзины, а также добавляет обработчик событий для корзины.

Методы:

- `set catalog(items: HTMLElement[])` - Метод для обновления содержимого каталога. Метод catalog заменяет все дочерние элементы элемента каталога новыми элементами из массива items.

#### Класс Success

Расширяет класс Modal. Предназначен для реализации модального окна успешное оформление. В модального окна отображается текст "Заказ оформлен" и общая сумма заказа.

Поля класса:

- `_close: HTMLButtonElement` - Кнопка закрытие и подтверждения
- `_total: HTMLElement` - Для отображение общая сумма заказа
- метод сеттер `set total`, который обновляет текстовое содержимое HTML-элемента \_total новым значением общей суммы. Метод использует регулярное выражение \d+ для совпадения с одной или несколькими цифрами в текущем текстовом содержимом и замены его новым значением общей суммы.

### Слой коммуникации

#### Класс AppApi

Класс `AppApi` расширяет класс `Api` и реализует интерфейс `IAPI`. Этот класс предназначен для взаимодействия с API и предоставляет методы для получения информации о карточках товаров и оформления заказов.

Методы:

- `getCardItem` - Получает информацию о карточке товара по его идентификатору.
- `getCardList` - Получает список всех карточек товаров.
- `orderCards` - Оформляет заказ на карточки товаров.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `basketCards:changed` - изменение массива карточек товара в корзину

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)._

- `basket:open` - открытие модального окна корзину
- `basket:order` - событие, при нажатии "Оформить" в модального окна корзину
- `card:select` - выбор товара для отображения в модальном окне
- `card:add` - добавить товар в корзину
- `card:delete` - выбор товара для удаления из корзину
- `payment:changed` - изменение данных выбор способ оплати
- `address:input` - изменение данных в форме выбор оплати и адресс
- `email:input` - изменение данных в форме контакты
- `phone:input` - изменение данных в форме контакты
- `orderContacts:submit` - событие, генерируемое при нажатии "Далее" в форме выбор оплати и адресс
- `orderAddress:submit` - событие, генерируемое при нажатии "Оплатить" в форме контакты
- `success:submit` - событие, при нажатии "За новыми покупками!" в форме о подтверждение успешной покупки
- `address:validation` - событие, сообщающее о необходимости валидации формы адресс
- `email:validation` - событие, сообщающее о необходимости валидации формы контакты
- `phone:validation` - событие, сообщающее о необходимости валидации формы контакты
